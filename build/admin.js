(()=>{"use strict";jQuery(document).ready(function(t){function e(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,function(t){return e[t]})}function n(n){const a=t("#import-preview"),i=t("#import-urls");if(0===n.count){let t="<h4>No URLs with instances found</h4>";return t+="<p>None of the URLs in your import file were found on this site.</p>",n.total_imported&&n.total_imported>0&&(t+="<p><strong>Total URLs in file:</strong> "+n.total_imported+"</p>",t+="<p><strong>URLs with zero instances:</strong> "+n.filtered_out+"</p>"),t+="<p>You may want to check your URLs or try importing a different file.</p>",a.html(t).show(),void i.hide()}let o="<h4>Preview: "+n.count+" replacements found";n.total_imported&&n.total_imported>n.count&&(o+=" (filtered from "+n.total_imported+" total URLs)"),o+="</h4>",n.filtered_out&&n.filtered_out>0&&(o+='<div class="inline notice notice-info"><p>',o+="<strong>Note:</strong> "+n.filtered_out+" URLs were filtered out because they have zero instances on this site. ",o+="Only URLs that actually exist on your site are shown below.",o+="</p></div>"),o+='<div class="preview-table">',o+='<table class="fixed wp-list-table widefat striped">',o+="<thead><tr><th>Old URL</th><th>New URL</th><th>Actions</th></tr></thead>",o+="<tbody>",n.replacements.forEach(function(t,n){o+='<tr class="replacement-row" data-index="'+n+'">',o+='<td><a href="'+e(t.from_url)+'" target="_blank">'+e(t.from_url)+"</a></td>",o+='<td><a href="'+e(t.to_url)+'" target="_blank">'+e(t.to_url)+"</a></td>",o+='<td class="actions-cell">',o+='<div class="action-buttons">',o+='<button type="button" class="button button-small button-secondary preview-locations-btn" data-index="'+n+'">Preview Locations</button>',o+='<button type="button" class="button button-small button-secondary edit-replacement-btn" data-index="'+n+'">Replace Single</button>',o+="</div>",o+="</td>",o+="</tr>",o+='<tr class="preview-row" data-index="'+n+'" style="display: none;">',o+='<td colspan="3" class="preview-content">',o+='<div class="preview-loading">Loading preview...</div>',o+="</td>",o+="</tr>"}),o+="</tbody></table></div>",o+='<p><strong>Review the replacements above. Click "Replace Single" to load each replacement into the form above for individual processing.</strong></p>',a.html(o).show(),i.hide(),window.importPreviewData=n}function a(n,a){const i=t("#import-result");i.removeClass("success error").addClass(a?"success":"error"),i.html("<p>"+e(n)+"</p>").show(),a&&setTimeout(function(){i.fadeOut()},5e3)}function i(){if(!window.searchResultsData)return"";const{locations:t,currentPage:n,itemsPerPage:a}=window.searchResultsData,i=Math.ceil(t.length/a),o=(n-1)*a,s=Math.min(o+a,t.length),r=t.slice(o,s);let l='<div class="search-results-table">';if(l+="<h4>Locations where this URL appears:</h4>",l+='<div class="pagination-info">',l+="Showing "+(o+1)+" to "+s+" of "+t.length+" locations",l+="</div>",l+='<div class="results-table">',l+='<table class="fixed wp-list-table widefat striped">',l+="<thead><tr><th>Title</th><th>Type</th><th>Count</th><th>Actions</th></tr></thead>",l+="<tbody>",r.forEach(function(t){l+="<tr>",l+="<td><strong>"+e(t.title)+"</strong></td>",l+="<td>"+e(t.type)+"</td>",l+="<td>"+t.count+"</td>",l+='<td class="actions-cell">',l+='<div class="action-buttons">',l+='<a href="'+e(t.url)+'" target="_blank" class="button button-small">View</a>',t.edit_url&&(l+='<a href="'+e(t.edit_url)+'" target="_blank" class="button button-small">Edit</a>'),l+="</div>",l+="</td>",l+="</tr>"}),l+="</tbody></table></div>",i>1){l+='<div class="pagination-controls">',n>1&&(l+='<button type="button" class="button button-secondary pagination-btn" data-page="'+(n-1)+'">← Previous</button>');const t=Math.max(1,n-2),e=Math.min(i,n+2);t>1&&(l+='<button type="button" class="button button-secondary pagination-btn" data-page="1">1</button>',t>2&&(l+='<span class="pagination-ellipsis">...</span>'));for(let a=t;a<=e;a++)l+='<button type="button" class="button'+(a===n?" button-primary":" button-secondary")+' pagination-btn" data-page="'+a+'">'+a+"</button>";e<i&&(e<i-1&&(l+='<span class="pagination-ellipsis">...</span>'),l+='<button type="button" class="button button-secondary pagination-btn" data-page="'+i+'">'+i+"</button>"),n<i&&(l+='<button type="button" class="button button-secondary pagination-btn" data-page="'+(n+1)+'">Next →</button>'),l+="</div>"}return l+="</div>",l}function o(e,n,a,i){let o='<div class="single-results-summary'+e+'">';o+="<h4>"+("success"===e?"✓ Success":"error"===e?"✗ Error":"ℹ Info")+"</h4>",o+="<p>"+n+"</p>",i&&(o+=i),o+="</div>",t("#single-results").html(o).show()}t("#preview-import").on("click",function(){const e=t("#import-file")[0].files[0];if(!e)return void alert("Please select a file to preview.");const i=new FileReader;i.onload=function(i){!function(e,i,o){const s=o,r=o.text();o.addClass("testing").text("Previewing..."),t.ajax({url:linkReplacement.ajaxUrl,type:"POST",data:{action:"link_replacement_preview_import",nonce:linkReplacement.nonce,file_content:e,file_type:i},success:function(t){t.success?n(t.data):a(t.data||"Error previewing file",!1)},error:function(){a("Error previewing file",!1)},complete:function(){s.removeClass("testing").text(r)}})}(i.target.result,e.name.toLowerCase().endsWith(".json")?"json":"csv",t(this))},i.readAsText(e)}),t("#import-urls").on("click",function(){const e=t("#import-file")[0].files[0];if(!e)return void alert("Please select a file to import.");const n=new FileReader;n.onload=function(n){!function(e,n,i){const o=i,s=i.text();i.addClass("testing").text(linkReplacement.strings.importing),t.ajax({url:linkReplacement.ajaxUrl,type:"POST",data:{action:"link_replacement_import_urls",nonce:linkReplacement.nonce,file_content:e,file_type:n},success:function(t){t.success?(a(t.data,!0),setTimeout(function(){window.location.reload()},2e3)):a(t.data||linkReplacement.strings.importError,!1)},error:function(){a(linkReplacement.strings.importError,!1)},complete:function(){o.removeClass("testing").text(s)}})}(n.target.result,e.name.toLowerCase().endsWith(".json")?"json":"csv",t(this))},n.readAsText(e)}),t("#find-instances").on("click",function(){const n=t("#single-from-url").val();n?function(n,a){const s=a,r=a.text();a.addClass("testing").text("Searching..."),t.ajax({url:linkReplacement.ajaxUrl,type:"POST",data:{action:"link_replacement_find_instances",nonce:linkReplacement.nonce,search_url:n},success:function(a){a.success?function(n,a){let s="Found "+n.total_found+' instances of "'+e(a)+'" in '+n.locations.length+" locations.",r="";n.total_found>0?(s+=' Click "Replace All Instances" to replace them.',t("#replace-instances").show(),window.searchResultsData={locations:n.locations,searchUrl:a,currentPage:1,itemsPerPage:25},r=i()):(s+=" No replacement needed.",t("#replace-instances").hide()),o("info",s,0,r)}(a.data,n):o("error",a.data||"Error finding instances")},error:function(){o("error","Error finding instances")},complete:function(){s.removeClass("testing").text(r)}})}(n,t(this)):alert("Please enter a URL to search for.")}),t("#replace-instances").on("click",function(){const a=t("#single-from-url").val(),i=t("#single-to-url").val();a&&i?confirm("Are you sure you want to replace all instances? This action cannot be undone.")&&function(a,i,s){const r=s,l=s.text();s.addClass("testing").text("Replacing..."),t.ajax({url:linkReplacement.ajaxUrl,type:"POST",data:{action:"link_replacement_replace_instances",nonce:linkReplacement.nonce,from_url:a,to_url:i},success:function(s){s.success?(function(n,a,i){let s='Successfully replaced "'+e(a)+'" with "'+e(i)+'".',r='<div class="single-results-details">';r+='<div class="single-results-stat">',r+='<span class="number">'+n.replaced_posts+"</span>",r+='<span class="label">Posts & Pages</span>',r+="</div>",r+='<div class="single-results-stat">',r+='<span class="number">'+n.replaced_meta+"</span>",r+='<span class="label">Post Meta (ACF)</span>',r+="</div>",r+="</div>",o("success",s,0,r),t("#replace-instances").hide()}(s.data,a,i),window.importPreviewData&&t("#import-preview").is(":visible")&&function(){if(!window.importPreviewData)return;const e=t("#single-from-url").val(),a=t("#single-to-url").val();e&&a&&(window.importPreviewData.replacements=window.importPreviewData.replacements.filter(function(t){return!(t.from_url===e&&t.to_url===a)}),window.importPreviewData.count=window.importPreviewData.replacements.length,n(window.importPreviewData))}()):o("error",s.data||"Error replacing instances")},error:function(){o("error","Error replacing instances")},complete:function(){r.removeClass("testing").text(l)}})}(a,i,t(this)):alert("Please enter both URLs.")}),t(document).on("click",".edit-replacement-btn",function(){!function(e){if(!window.importPreviewData||!window.importPreviewData.replacements[e])return;const n=window.importPreviewData.replacements[e];t("#single-from-url").val(n.from_url),t("#single-to-url").val(n.to_url),t("html, body").animate({scrollTop:t(".link-replacement-single-replacement").offset().top-100},500),t("#single-results").html('<div class="single-results-summary info"><h4>ℹ Info</h4><p>Replacement loaded into Single URL Replacement form above.</p></div>').show()}(parseInt(t(this).data("index")))}),t(document).on("click",".preview-locations-btn",function(){const n=parseInt(t(this).data("index")),a=t(this),i=t('.preview-row[data-index="'+n+'"]');i.is(":visible")?(i.hide(),a.text("Preview Locations")):(i.show(),a.text("Hide Preview"),function(n){if(!window.importPreviewData||!window.importPreviewData.replacements[n])return;const a=window.importPreviewData.replacements[n],i=t('.preview-row[data-index="'+n+'"] .preview-content');i.html('<div class="preview-loading">Searching for instances...</div>'),t.ajax({url:linkReplacement.ajaxUrl,type:"POST",data:{action:"link_replacement_find_instances",nonce:linkReplacement.nonce,search_url:a.from_url},success:function(t){t.success?function(t,n){let a='<div class="location-preview">';a+="<h5>Found "+t.total_found+" instances in "+t.locations.length+" locations:</h5>",t.locations.length>0?(a+='<div class="location-list">',t.locations.forEach(function(t){a+='<div class="location-item">',a+='<div class="location-header">',a+="<strong>"+e(t.title)+"</strong>",a+='<span class="location-type">('+e(t.type)+")</span>",a+='<span class="location-count">'+t.count+" instance(s)</span>",a+="</div>",a+='<div class="location-actions">',a+='<a href="'+e(t.url)+'" target="_blank" class="button button-small">View</a>',t.edit_url&&(a+='<a href="'+e(t.edit_url)+'" target="_blank" class="button button-small">Edit</a>'),a+="</div>",a+="</div>"}),a+="</div>"):a+="<p>No instances found.</p>",a+="</div>",n.html(a)}(t.data,i):i.html('<div class="preview-error">Error: '+e(t.data||"Unknown error")+"</div>")},error:function(){i.html('<div class="preview-error">Error loading preview</div>')}})}(n))}),t(document).on("click",".pagination-btn",function(){const e=parseInt(t(this).data("page"));if(!window.searchResultsData||e<1)return;window.searchResultsData.currentPage=e;const n=t("#single-results"),a=n.html(),o=i(),s=a.replace(/<div class="search-results-table">[\s\S]*<\/div>/,o);n.html(s)})})})();